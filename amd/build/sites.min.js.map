{"version":3,"file":"sites.min.js","sources":["../src/sites.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package\n * @author  2022 3iPunt <https://www.tresipunt.com/>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/templates'\n], function($, Str, Ajax, Templates) {\n    \"use strict\";\n\n\n    let SERVICES = {\n        SITE_ADD: 'local_coursetransfer_site_add',\n        SITE_EDIT: 'local_coursetransfer_site_edit',\n        SITE_REMOVE: 'local_coursetransfer_site_remove',\n    };\n\n    let ACTIONS = {\n        CREATE: '[data-action=\"create\"]',\n        EDIT: '[data-action=\"edit\"]',\n        REMOVE: '[data-action=\"remove\"]',\n    };\n\n    /**\n     * @param {String} region\n     * @param {String} type\n     *\n     * @constructor\n     */\n    function sites(region, type) {\n        this.node = $(region);\n        this.type = type;\n        console.log('Sites');\n        this.node.find(ACTIONS.CREATE).on('click', this.clickCreate.bind(this));\n        this.node.find(ACTIONS.EDIT).on('click', this.clickEdit.bind(this));\n        this.node.find(ACTIONS.REMOVE).on('click', this.clickRemove.bind(this));\n    }\n\n    sites.prototype.clickCreate = function(e) {\n        let button = $(e.currentTarget);\n        button.attr('disabled', true);\n        let createregion = this.node.find('#createDestiny');\n        let host = createregion.find('#host').val();\n        let token = createregion.find('#token').val();\n\n        const request = {\n            methodname: SERVICES.SITE_ADD,\n            args: {\n                type: this.type,\n                host: host.trim(),\n                token: token.trim(),\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.success) {\n                location.reload();\n            } else {\n                console.log(response);\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.clickEdit = function(e) {\n        let button = $(e.currentTarget);\n        let siteid = button.data('id');\n        let editregion = this.node.find('#destinyEdit' + siteid);\n        let host = editregion.find('#host').val();\n        let token = editregion.find('#token').val();\n        button.attr('disabled', true);\n        const request = {\n            methodname: SERVICES.SITE_EDIT,\n            args: {\n                type: this.type,\n                id: siteid,\n                host: host.trim(),\n                token: token.trim(),\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.success) {\n                location.reload();\n            } else {\n                console.log(response);\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.clickRemove = function(e) {\n        let button = $(e.currentTarget);\n        button.attr('disabled', true);\n        let siteid = button.data('id');\n        const request = {\n            methodname: SERVICES.SITE_REMOVE,\n            args: {\n                type: this.type,\n                id: siteid\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.success) {\n                location.reload();\n            } else {\n                console.log(response);\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.node = null;\n\n    return {\n        /**\n         * @param {String} region\n         * @param {String} type\n         * @return {sites}\n         */\n        initSites: function(region, type) {\n            // eslint-disable-next-line babel/new-cap\n            return new sites(region, type);\n        }\n    };\n});\n"],"names":["define","$","Str","Ajax","Templates","SERVICES","ACTIONS","sites","region","type","node","console","log","find","on","this","clickCreate","bind","clickEdit","clickRemove","prototype","e","currentTarget","attr","createregion","host","val","token","request","methodname","args","trim","call","done","response","success","location","reload","fail","button","siteid","data","editregion","id","initSites"],"mappings":";;;;;AAwBAA,oCAAO,CACH,SACA,WACA,YACA,mBACD,SAASC,EAAGC,IAAKC,KAAMC,eAIlBC,kBACU,gCADVA,mBAEW,iCAFXA,qBAGa,mCAGbC,eACQ,yBADRA,aAEM,uBAFNA,eAGQ,kCASHC,MAAMC,OAAQC,WACdC,KAAOT,EAAEO,aACTC,KAAOA,KACZE,QAAQC,IAAI,cACPF,KAAKG,KAAKP,gBAAgBQ,GAAG,QAASC,KAAKC,YAAYC,KAAKF,YAC5DL,KAAKG,KAAKP,cAAcQ,GAAG,QAASC,KAAKG,UAAUD,KAAKF,YACxDL,KAAKG,KAAKP,gBAAgBQ,GAAG,QAASC,KAAKI,YAAYF,KAAKF,cAGrER,MAAMa,UAAUJ,YAAc,SAASK,GACtBpB,EAAEoB,EAAEC,eACVC,KAAK,YAAY,OACpBC,aAAeT,KAAKL,KAAKG,KAAK,kBAC9BY,KAAOD,aAAaX,KAAK,SAASa,MAClCC,MAAQH,aAAaX,KAAK,UAAUa,YAElCE,QAAU,CACZC,WAAYxB,kBACZyB,KAAM,CACFrB,KAAMM,KAAKN,KACXgB,KAAMA,KAAKM,OACXJ,MAAOA,MAAMI,SAGrB5B,KAAK6B,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAC9BA,SAASC,QACTC,SAASC,SAET1B,QAAQC,IAAIsB,aAEjBI,MAAK,SAASA,MACb3B,QAAQC,IAAI0B,UAIpB/B,MAAMa,UAAUF,UAAY,SAASG,OAC7BkB,OAAStC,EAAEoB,EAAEC,eACbkB,OAASD,OAAOE,KAAK,MACrBC,WAAa3B,KAAKL,KAAKG,KAAK,eAAiB2B,QAC7Cf,KAAOiB,WAAW7B,KAAK,SAASa,MAChCC,MAAQe,WAAW7B,KAAK,UAAUa,MACtCa,OAAOhB,KAAK,YAAY,SAClBK,QAAU,CACZC,WAAYxB,mBACZyB,KAAM,CACFrB,KAAMM,KAAKN,KACXkC,GAAIH,OACJf,KAAMA,KAAKM,OACXJ,MAAOA,MAAMI,SAGrB5B,KAAK6B,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAC9BA,SAASC,QACTC,SAASC,SAET1B,QAAQC,IAAIsB,aAEjBI,MAAK,SAASA,MACb3B,QAAQC,IAAI0B,UAIpB/B,MAAMa,UAAUD,YAAc,SAASE,OAC/BkB,OAAStC,EAAEoB,EAAEC,eACjBiB,OAAOhB,KAAK,YAAY,OACpBiB,OAASD,OAAOE,KAAK,YACnBb,QAAU,CACZC,WAAYxB,qBACZyB,KAAM,CACFrB,KAAMM,KAAKN,KACXkC,GAAIH,SAGZrC,KAAK6B,KAAK,CAACJ,UAAU,GAAGK,MAAK,SAASC,UAC9BA,SAASC,QACTC,SAASC,SAET1B,QAAQC,IAAIsB,aAEjBI,MAAK,SAASA,MACb3B,QAAQC,IAAI0B,UAIpB/B,MAAMa,UAAUV,KAAO,KAEhB,CAMHkC,UAAW,SAASpC,OAAQC,aAEjB,IAAIF,MAAMC,OAAQC"}