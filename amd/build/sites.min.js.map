{"version":3,"file":"sites.min.js","sources":["../src/sites.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos.\n\n/**\n *\n * @module     local_coursetransfer\n * @copyright  2023 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-console */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/templates'\n], function($, Str, Ajax, Templates) {\n    \"use strict\";\n\n\n    let SERVICES = {\n        SITE_ADD: 'local_coursetransfer_site_add',\n        SITE_EDIT: 'local_coursetransfer_site_edit',\n        SITE_REMOVE: 'local_coursetransfer_site_remove',\n        SITE_TEST: 'local_coursetransfer_site_test',\n    };\n\n    let ACTIONS = {\n        CREATE: '[data-action=\"create\"]',\n        EDIT: '[data-action=\"edit\"]',\n        REMOVE: '[data-action=\"remove\"]',\n        TEST: '[data-action=\"test\"]',\n    };\n\n    let REGIONS = {\n        CREATE : '#createSite',\n        EDIT : '#editSite-',\n        TEST_OK : '[data-region=\"test-ok\"]',\n        TEST_KO : '[data-region=\"test-ko\"]',\n        ERROR_MSG : '[data-region=\"error-msg\"]'\n    };\n\n    /**\n     * @param {String} region\n     * @param {String} type\n     *\n     * @constructor\n     */\n    function sites(region, type) {\n        this.node = $(region);\n        this.type = type;\n        console.log('Sites');\n        this.node.find(ACTIONS.CREATE).on('click', this.clickCreate.bind(this));\n        this.node.find(ACTIONS.EDIT).on('click', this.clickEdit.bind(this));\n        this.node.find(ACTIONS.REMOVE).on('click', this.clickRemove.bind(this));\n        this.node.find(ACTIONS.TEST).on('click', this.clickTest.bind(this));\n    }\n\n    sites.prototype.clickCreate = function(e) {\n        let button = $(e.currentTarget);\n        button.attr('disabled', true);\n        let createregion = this.node.find(REGIONS.CREATE);\n        let host = createregion.find('#host').val();\n        let token = createregion.find('#token').val();\n        let errormsg = this.node.find(REGIONS.ERROR_MSG);\n\n        const request = {\n            methodname: SERVICES.SITE_ADD,\n            args: {\n                type: this.type,\n                host: host.trim(),\n                token: token.trim(),\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.success) {\n                location.reload();\n            } else {\n                console.log(response);\n                errormsg.text(response.errors[0].msg);\n                errormsg.show();\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.clickEdit = function(e) {\n        let button = $(e.currentTarget);\n        let siteid = button.data('id');\n        let editregion = this.node.find(REGIONS.EDIT + siteid);\n        let host = editregion.find('#host').val();\n        let token = editregion.find('#token').val();\n        let errormsg = this.node.find(REGIONS.ERROR_MSG);\n\n        button.attr('disabled', true);\n        const request = {\n            methodname: SERVICES.SITE_EDIT,\n            args: {\n                type: this.type,\n                id: siteid,\n                host: host.trim(),\n                token: token.trim(),\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.success) {\n                location.reload();\n            } else {\n                console.log(response);\n                errormsg.text(response.errors[0].msg);\n                errormsg.show();\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.clickTest = function(e) {\n        let $button = $(e.currentTarget);\n        let siteid = $button.data('id');\n        $button.attr('disabled', true);\n        $button.addClass('btn-light', true);\n        $button.removeClass('btn-success', true);\n        $button.removeClass('btn-danger', true);\n        let $buttonerror = $('[data-target=\"#error-' + siteid + '\"]');\n        $buttonerror.addClass('hidden');\n        $buttonerror.data('content', '');\n        $button.find(REGIONS.TEST_OK).addClass('hidden');\n        $button.find(REGIONS.TEST_KO).addClass('hidden');\n        const request = {\n            methodname: SERVICES.SITE_TEST,\n            args: {\n                type: this.type,\n                id: siteid\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            $button.attr('disabled', false);\n            console.log(response);\n            if (response.success) {\n                $button.find(REGIONS.TEST_OK).removeClass('hidden');\n                $button.addClass('btn-success', true);\n                $button.removeClass('btn-light', true);\n            } else {\n                $button.find(REGIONS.TEST_KO).removeClass('hidden');\n                $buttonerror.removeClass('hidden');\n                $button.addClass('btn-danger', true);\n                $button.removeClass('btn-light', true);\n                $buttonerror.data('content', response.error.msg);\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.clickRemove = function(e) {\n        let button = $(e.currentTarget);\n        button.attr('disabled', true);\n        let siteid = button.data('id');\n        const request = {\n            methodname: SERVICES.SITE_REMOVE,\n            args: {\n                type: this.type,\n                id: siteid\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.success) {\n                location.reload();\n            } else {\n                console.log(response);\n            }\n        }).fail(function(fail) {\n            console.log(fail);\n        });\n    };\n\n    sites.prototype.node = null;\n\n    return {\n        /**\n         * @param {String} region\n         * @param {String} type\n         * @return {sites}\n         */\n        initSites: function(region, type) {\n            // eslint-disable-next-line babel/new-cap\n            return new sites(region, type);\n        }\n    };\n});\n"],"names":["define","$","Str","Ajax","Templates","SERVICES","ACTIONS","REGIONS","sites","region","type","node","console","log","find","on","this","clickCreate","bind","clickEdit","clickRemove","clickTest","prototype","e","currentTarget","attr","createregion","host","val","token","errormsg","request","methodname","args","trim","call","done","response","success","location","reload","text","errors","msg","show","fail","button","siteid","data","editregion","id","$button","addClass","removeClass","$buttonerror","error","initSites"],"mappings":"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"}