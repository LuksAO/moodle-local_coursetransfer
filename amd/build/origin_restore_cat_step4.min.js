/**
 * @package
 * @author  2022 3iPunt <https://www.tresipunt.com/>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_cat_step4",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){let SERVICES_ORIGIN_RESTORE_STEP4="local_coursetransfer_origin_restore_cat_step4",ACTIONS_DESTINY='[data-action="destiny"]',ACTIONS_RESTORE='[data-action="execute-restore"]';function originRestoreCatStep4(region,site){if(this.node=$(region),this.site=site,this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_cat_page")),this.data){if(this.data.destinyid){let destinyid=parseInt(this.data.destinyid);this.node.find(ACTIONS_DESTINY).val(destinyid),this.node.find(ACTIONS_DESTINY).prop("disabled",!0)}this.data.configuration&&this.data.configuration.forEach((function(config){let item=$("#"+config.name);item.prop("checked",config.selected),item.prop("disabled",!0)})),this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this))}}return originRestoreCatStep4.prototype.clickNext=function(e){this.node.find(ACTIONS_RESTORE).prop("disabled",!0);let configuration=[];this.data.configuration.forEach((function(config){configuration[config.name]=config.selected}));let alertbox=this.node.find(".alert");const request={methodname:SERVICES_ORIGIN_RESTORE_STEP4,args:{siteurl:this.site,catid:this.data.catid,destinyid:this.data.destinyid,configuration:{destiny_merge_activities:configuration.destiny_merge_activities,destiny_remove_activities:configuration.destiny_remove_activities,destiny_remove_groups:configuration.destiny_remove_groups,destiny_remove_enrols:configuration.destiny_remove_enrols,origin_enrol_users:configuration.origin_enrol_users}}};let that=this;Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){let errors=[{code:"100081",msg:"error_not_controlled"}];that.renderErrors(errors,alertbox)}else that.renderErrors(response.errors,alertbox)})).fail((function(fail){let errors=[];fail.error?errors.push({code:"100082",msg:fail.error}):fail.message?errors.push({code:"100083",msg:fail.message}):errors=[{code:"100084",msg:"error_not_controlled"}],that.renderErrors(errors,alertbox)}))},originRestoreCatStep4.prototype.renderErrors=function(errors,alertbox){let errorString="";alertbox.removeClass("hidden"),errors.forEach((error=>{errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},originRestoreCatStep4.prototype.node=null,{initRestoreCatStep4:function(region,site){return new originRestoreCatStep4(region,site)}}}));

//# sourceMappingURL=origin_restore_cat_step4.min.js.map