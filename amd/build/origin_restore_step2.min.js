/**
 *
 * @module     local_coursetransfer/origin_restore_step2
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_step2",["jquery","core/str","core/ajax","core/templates","local_coursetransfer/JSONutil"],(function($,Str,Ajax,Templates,JSONutil){var ACTIONS_COURSE_SELECT='[data-action="select"]',ACTIONS_NEXT='[data-action="next"]',ACTIONS_DESTINY='[data-action="destiny"]';function originRestoreStep2(region){this.node=$(region),this.DOMregion=this.node[0],this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_page"),JSONutil.reviver),console.log("Initial data: ",this.data),null!==this.data?this.data.courses.forEach((function(course){var courseid=parseInt(course.courseid),destinyid=parseInt(course.destinyid);$(ACTIONS_COURSE_SELECT+'[data-courseid="'+courseid+'"]').prop("checked",!0),$('[data-action="destiny"][data-courseid="'+courseid+'"] option[value="'+destinyid+'"]').prop("selected",!0)})):(this.data={courses:new Map,configuration:[]},sessionStorage.setItem("local_coursetransfer_restore_page",JSON.stringify(this.data,JSONutil.replacer))),this.data.courses.size>0?this.node.find(ACTIONS_NEXT).removeAttr("disabled"):this.node.find(ACTIONS_NEXT).prop("disabled",!0),this.node.find(ACTIONS_COURSE_SELECT).on("click",this.selectCourse.bind(this)),this.node.find(ACTIONS_DESTINY).on("change",this.selectDestiny.bind(this)),this.node.find(ACTIONS_NEXT).on("click",this.clickNext.bind(this))}return originRestoreStep2.prototype.selectCourse=function(e){var item=e.target,courseid=item.dataset.courseid;if(item.checked){var course={courseid:courseid,destinyid:this.DOMregion.querySelector('[data-action="destiny"][data-courseid="'+courseid+'"]').value,categorydestiny:0};this.data.courses.set(courseid.toString(),course),this.node.find(ACTIONS_NEXT).removeAttr("disabled")}else this.data.courses.delete(courseid.toString()),this.data.courses.size<1&&this.node.find(ACTIONS_NEXT).prop("disabled",!0);sessionStorage.setItem("local_coursetransfer_restore_page",JSON.stringify(this.data,JSONutil.replacer))},originRestoreStep2.prototype.selectDestiny=function(e){var item=e.target,courseid=item.dataset.courseid;if(this.DOMregion.querySelector('[data-action="select"][data-courseid="'+courseid+'"]').checked){var course={courseid:courseid,destinyid:item.value,categorydestiny:0};this.data.courses.set(courseid,course),sessionStorage.setItem("local_coursetransfer_restore_page",JSON.stringify(this.data,JSONutil.replacer))}},originRestoreStep2.prototype.clickNext=function(e){var currentUrl=$(location).attr("href"),url=new URL(currentUrl);url.searchParams.set("step","3"),window.location.href=url.href},originRestoreStep2.prototype.node=null,originRestoreStep2.prototype.DOMregion=null,{initRestoreStep2:function(region){return new originRestoreStep2(region)}}}));

//# sourceMappingURL=origin_restore_step2.min.js.map