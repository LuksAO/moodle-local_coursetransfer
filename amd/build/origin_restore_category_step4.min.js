/**
 *
 * @module     local_coursetransfer
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_category_step4",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){var SERVICES_RESTORE_CATEGORY_STEP4="local_coursetransfer_new_origin_restore_category_step4",ACTIONS_RESTORE='[data-action="execute-restore"]';function restoreCategoryStep4(region,site){this.node=$(region),this.restoreid=$("[data-restoreid]").attr("data-restoreid"),this.destinyid=$("[data-destinyid]").attr("data-destinyid"),this.site=site,this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this));var storageid=this.node.find('[data-region="session-storage"]');this.sessiondata=JSON.parse(sessionStorage.getItem(storageid.data("session")));var courses=this.sessiondata.category.courses,courseinputs=$('input[type="checkbox"]');courseinputs.prop("disabled",!0),courseinputs.prop("checked",!1),courses.forEach((function(course){var selector='[data-courseid="'+course.id+'"]';$(selector).prop("checked",!0)})),this.sessiondata.configuration&&(this.sessiondata.configuration.forEach((function(config){var item=$("#"+config.name);"origin_schedule_datetime"===config.name?item.val(config.value):(item.prop("disabled",!0),item.prop("checked",config.selected))})),this.sessiondata.configuration.forEach((function(config){"origin_schedule"===config.name&&(config.selected||$("#origin_schedule_datetime").val(null))})),this.sessiondata.configuration.forEach((function(config){"origin_schedule_datetime"===config.name&&(config.value||$("#origin_schedule").prop("checked",!1))})))}return restoreCategoryStep4.prototype.clickNext=function(e){this.node.find(ACTIONS_RESTORE).prop("disabled",!0);var self=this,alertbox=this.node.find(".alert"),nextruntime=$("#origin_schedule_datetime").val();nextruntime=$("#origin_schedule").prop("checked")?""===nextruntime?0:new Date(nextruntime).getTime():0;var siteurl=this.site,categoryid=this.restoreid,destinyid=this.destinyid,request={methodname:SERVICES_RESTORE_CATEGORY_STEP4,args:{siteurl:siteurl,categoryid:categoryid,destinyid:destinyid,courses:this.sessiondata.category.courses,nextruntime:nextruntime}};Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){self.renderErrors([{code:"100011",msg:"error_not_controlled"}],alertbox)}else self.renderErrors(response.errors,alertbox)})).fail((function(fail){var errors=[{code:"100012",msg:fail.message}];self.renderErrors(errors,alertbox)}))},restoreCategoryStep4.prototype.renderErrors=function(errors,alertbox){var errorString="";alertbox.removeClass("hidden"),errors.forEach((function(error){errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},restoreCategoryStep4.prototype.node=null,{initRestoreCategoryStep4:function(region,site){return new restoreCategoryStep4(region,site)}}}));

//# sourceMappingURL=origin_restore_category_step4.min.js.map