/**
 * @package
 * @author  2022 3iPunt <https://www.tresipunt.com/>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_category_step4",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){let SERVICES_RESTORE_CATEGORY_STEP4="local_coursetransfer_new_origin_restore_category_step4",ACTIONS_RESTORE='[data-action="execute-restore"]';function restoreCategoryStep4(region,site){this.node=$(region),this.restoreid=$("[data-restoreid]").attr("data-restoreid"),this.destinyid=$("[data-destinyid]").attr("data-destinyid"),this.site=site,this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this));let courses=JSON.parse(sessionStorage.getItem("data-category-sessionStorageId")).category.courses;$('input[type="checkbox"]').prop("disabled",!0),courses.forEach((function(course){if(course.selected){$("#course-"+course.id).addClass("selected")}}))}return restoreCategoryStep4.prototype.clickNext=function(e){let self=this,alertbox=this.node.find(".alert"),siteurl=this.site,courseid=this.restoreid,destinyid=this.destinyid,sessiondata=JSON.parse(sessionStorage.getItem($("[data-course-sessionStorageId]").attr("data-course-sessionStorageId"))),configuration={};sessiondata.course.configuration.forEach((function(config){configuration[config.name]=config.selected}));const request={methodname:SERVICES_RESTORE_CATEGORY_STEP4,args:{siteurl:siteurl,courseid:courseid,destinyid:destinyid,configuration:configuration,sections:sessiondata.course.sections}};Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){let errors=[{code:"064893",msg:"error_not_controlled"}];self.renderErrors(errors,alertbox)}else self.renderErrors(response.errors,alertbox)})).fail((function(fail){let errors=[{code:"064896",msg:fail.message}];self.renderErrors(errors,alertbox)}))},restoreCategoryStep4.prototype.renderErrors=function(errors,alertbox){let errorString="";alertbox.removeClass("hidden"),errors.forEach((error=>{errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},restoreCategoryStep4.prototype.node=null,{initRestoreCategoryStep4:function(region,site){return new restoreCategoryStep4(region,site)}}}));

//# sourceMappingURL=origin_restore_category_step4.min.js.map