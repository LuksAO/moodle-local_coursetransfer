/**
 * @package
 * @author  2022 3iPunt <https://www.tresipunt.com/>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_category_step4",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){let SERVICES_RESTORE_CATEGORY_STEP4="local_coursetransfer_new_origin_restore_category_step4",ACTIONS_RESTORE='[data-action="execute-restore"]';function restoreCategoryStep4(region,site){this.node=$(region),this.restoreid=$("[data-restoreid]").attr("data-restoreid"),this.destinyid=$("[data-destinyid]").attr("data-destinyid"),this.site=site,this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this));let storageid=this.node.find('[data-region="session-storage"]');this.sessiondata=JSON.parse(sessionStorage.getItem(storageid.data("session")));let courses=this.sessiondata.category.courses,courseinputs=$('input[type="checkbox"]');courseinputs.prop("disabled",!0),courseinputs.prop("checked",!1),courses.forEach((function(course){let selector='[data-courseid="'+course.id+'"]';$(selector).prop("checked",!0)}))}return restoreCategoryStep4.prototype.clickNext=function(e){let self=this,alertbox=this.node.find(".alert"),siteurl=this.site,categoryid=this.restoreid,destinyid=this.destinyid;const request={methodname:SERVICES_RESTORE_CATEGORY_STEP4,args:{siteurl:siteurl,categoryid:categoryid,destinyid:destinyid,courses:this.sessiondata.category.courses}};Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){let errors=[{code:"064893",msg:"error_not_controlled"}];self.renderErrors(errors,alertbox)}else self.renderErrors(response.errors,alertbox)})).fail((function(fail){let errors=[{code:"064896",msg:fail.message}];self.renderErrors(errors,alertbox)}))},restoreCategoryStep4.prototype.renderErrors=function(errors,alertbox){let errorString="";alertbox.removeClass("hidden"),errors.forEach((error=>{errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},restoreCategoryStep4.prototype.node=null,{initRestoreCategoryStep4:function(region,site){return new restoreCategoryStep4(region,site)}}}));

//# sourceMappingURL=origin_restore_category_step4.min.js.map