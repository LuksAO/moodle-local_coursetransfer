/**
 *
 * @module     local_coursetransfer/origin_restore_step3
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_restore_step3",["jquery","core/str","core/ajax","core/templates","local_coursetransfer/JSONutil"],(function($,Str,Ajax,Templates,JSONutil){let ACTIONS_COURSE_SELECT='[data-action="select"]',ACTIONS_NEXT='[data-action="next"]';function originRestoreStep3(region){this.node=$(region),this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_page"),JSONutil.reviver);let newcourses=[];this.data.courses.forEach((function(course){course.targetid=0,course.categorytarget=0,newcourses.push(course)})),this.data.courses=newcourses,sessionStorage.setItem("local_coursetransfer_restore_page",JSON.stringify(this.data,JSONutil.replacer)),this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_page"),JSONutil.reviver),console.log("Step 3 data: ",this.data),null!==this.data&&(this.data.courses.forEach((function(course){let courseid=parseInt(course.courseid),targetid=parseInt(course.targetid);$(ACTIONS_COURSE_SELECT+'[data-courseid="'+courseid+'"]').prop("checked",!0),$('[data-action="target"][data-courseid="'+courseid+'"] option[value="'+targetid+'"]').prop("selected",!0)})),this.data.configuration.forEach((function(config){$("#"+config.name).prop("checked",config.selected)}))),this.node.find(ACTIONS_NEXT).on("click",this.clickNext.bind(this)),this.node.find("#origin_schedule").on("click",this.clickSchedule.bind(this))}return originRestoreStep3.prototype.clickNext=function(e){this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_page"),JSONutil.reviver);let checkboxes=$(".configuration-checkbox"),configuration=[];checkboxes.each((function(){if("origin_schedule_datetime"===$(this).attr("id")){let datetime=$(this).val();configuration.push({name:$(this).attr("id"),value:datetime})}else configuration.push({name:$(this).attr("id"),selected:$(this).prop("checked")})})),this.data.configuration=configuration,sessionStorage.setItem("local_coursetransfer_restore_page",JSON.stringify(this.data,JSONutil.replacer)),this.generateForm().submit()},originRestoreStep3.prototype.generateForm=function(){this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_page"),JSONutil.reviver);let currentUrl=$(location).attr("href"),url=new URL(currentUrl);url.searchParams.set("step","4");let coursesForm=document.createElement("form");coursesForm.action=url.href,coursesForm.method="POST";let input=[];this.data.courses.forEach((function(course,index){input[index]=document.createElement("INPUT"),input[index].name="courseids[]",input[index].value=course.courseid,input[index].type="hidden",coursesForm.appendChild(input[index])}));let input2=[];this.data.courses.forEach((function(course,index){input2[index]=document.createElement("INPUT"),input2[index].name="targetids[]",input2[index].value=course.targetid,input2[index].type="hidden",coursesForm.appendChild(input2[index])}));let input3=[];return this.data.courses.forEach((function(course,index){input3[index]=document.createElement("INPUT"),input3[index].name="categorytargets[]",input3[index].value=course.categorytarget,input3[index].type="hidden",coursesForm.appendChild(input3[index])})),document.body.appendChild(coursesForm),coursesForm},originRestoreStep3.prototype.clickSchedule=function(e){this.node.find("#origin_schedule").is(":checked")?this.node.find("#origin_schedule_datetime").attr("disabled",!1):this.node.find("#origin_schedule_datetime").attr("disabled",!0)},originRestoreStep3.prototype.node=null,{initRestoreStep3:function(region){return new originRestoreStep3(region)}}}));

//# sourceMappingURL=origin_restore_step3.min.js.map