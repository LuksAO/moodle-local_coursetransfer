/**
 *
 * @module     local_coursetransfer
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/sites",["jquery","core/str","core/ajax","core/templates"],(function($,Str,Ajax,Templates){var SERVICES_SITE_ADD="local_coursetransfer_site_add",SERVICES_SITE_EDIT="local_coursetransfer_site_edit",SERVICES_SITE_REMOVE="local_coursetransfer_site_remove",SERVICES_SITE_TEST="local_coursetransfer_site_test",ACTIONS_CREATE='[data-action="create"]',ACTIONS_EDIT='[data-action="edit"]',ACTIONS_REMOVE='[data-action="remove"]',ACTIONS_TEST='[data-action="test"]',REGIONS_CREATE="#createSite",REGIONS_EDIT="#editSite-",REGIONS_TEST_OK='[data-region="test-ok"]',REGIONS_TEST_KO='[data-region="test-ko"]',REGIONS_ERROR_MSG='[data-region="error-msg"]';function sites(region,type){this.node=$(region),this.type=type,console.log("Sites"),this.node.find(ACTIONS_CREATE).on("click",this.clickCreate.bind(this)),this.node.find(ACTIONS_EDIT).on("click",this.clickEdit.bind(this)),this.node.find(ACTIONS_REMOVE).on("click",this.clickRemove.bind(this)),this.node.find(ACTIONS_TEST).on("click",this.clickTest.bind(this))}return sites.prototype.clickCreate=function(e){$(e.currentTarget).attr("disabled",!0);var createregion=this.node.find(REGIONS_CREATE),host=createregion.find("#host").val(),token=createregion.find("#token").val(),errormsg=this.node.find(REGIONS_ERROR_MSG),request={methodname:SERVICES_SITE_ADD,args:{type:this.type,host:host.trim(),token:token.trim()}};Ajax.call([request])[0].done((function(response){response.success?location.reload():(console.log(response),errormsg.text(response.errors[0].msg),errormsg.show())})).fail((function(fail){console.log(fail)}))},sites.prototype.clickEdit=function(e){var button=$(e.currentTarget),siteid=button.data("id"),editregion=this.node.find(REGIONS_EDIT+siteid),host=editregion.find("#host").val(),token=editregion.find("#token").val(),errormsg=this.node.find(REGIONS_ERROR_MSG);button.attr("disabled",!0);var request={methodname:SERVICES_SITE_EDIT,args:{type:this.type,id:siteid,host:host.trim(),token:token.trim()}};Ajax.call([request])[0].done((function(response){response.success?location.reload():(console.log(response),errormsg.text(response.errors[0].msg),errormsg.show())})).fail((function(fail){console.log(fail)}))},sites.prototype.clickTest=function(e){var $button=$(e.currentTarget),siteid=$button.data("id");$button.attr("disabled",!0),$button.addClass("btn-light",!0),$button.removeClass("btn-success",!0),$button.removeClass("btn-danger",!0);var $buttonerror=$('[data-target="#error-'+siteid+'"]');$buttonerror.addClass("hidden"),$buttonerror.data("content",""),$button.find(REGIONS_TEST_OK).addClass("hidden"),$button.find(REGIONS_TEST_KO).addClass("hidden");var request={methodname:SERVICES_SITE_TEST,args:{type:this.type,id:siteid}};Ajax.call([request])[0].done((function(response){$button.attr("disabled",!1),console.log(response),response.success?($button.find(REGIONS_TEST_OK).removeClass("hidden"),$button.addClass("btn-success",!0),$button.removeClass("btn-light",!0)):($button.find(REGIONS_TEST_KO).removeClass("hidden"),$buttonerror.removeClass("hidden"),$button.addClass("btn-danger",!0),$button.removeClass("btn-light",!0),$buttonerror.data("content",response.error.msg))})).fail((function(fail){console.log(fail)}))},sites.prototype.clickRemove=function(e){var button=$(e.currentTarget);button.attr("disabled",!0);var siteid=button.data("id"),request={methodname:SERVICES_SITE_REMOVE,args:{type:this.type,id:siteid}};Ajax.call([request])[0].done((function(response){response.success?location.reload():console.log(response)})).fail((function(fail){console.log(fail)}))},sites.prototype.node=null,{initSites:function(region,type){return new sites(region,type)}}}));

//# sourceMappingURL=sites.min.js.map