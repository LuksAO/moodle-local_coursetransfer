function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)
/**
 *
 * @module     local_coursetransfer
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */}define("local_coursetransfer/origin_restore_step4",["jquery","core/str","core/ajax","core/templates","local_coursetransfer/JSONutil"],(function($,Str,Ajax,Templates,JSONutil){var SERVICES_ORIGIN_RESTORE_STEP4="local_coursetransfer_origin_restore_step4",ACTIONS_RESTORE='[data-action="execute-restore"]';function originRestoreStep4(region,site){if(this.node=$(region),this.site=site,this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_restore_page"),JSONutil.reviver),this.data)this.data.courses.forEach((function(course){var courseid=parseInt(course.courseid),destinyid=parseInt(course.destinyid);$('[data-action="destiny"][data-courseid="'+courseid+'"] option[value="'+destinyid+'"]').prop("selected",!0),$('tr[data-action="course"][data-courseid="'+courseid+'"]').prop("selected",!0).removeClass("hidden"),0===destinyid&&$('[data-action="destiny-category"][data-courseid="'+courseid+'"]').removeClass("hidden")})),this.data.configuration&&(this.data.configuration.forEach((function(config){var item=$("#"+config.name);"origin_schedule_datetime"===config.name?item.val(config.value):(item.prop("disabled",!0),item.prop("checked",config.selected))})),this.data.configuration.forEach((function(config){"origin_schedule"===config.name&&(config.selected||$("#origin_schedule_datetime").val(null))})),this.data.configuration.forEach((function(config){"origin_schedule_datetime"===config.name&&(config.value||$("#origin_schedule").prop("checked",!1))}))),this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this));else{var alertbox=this.node.find(".alert");this.renderErrors([{code:"100078",msg:"error_session_cache"}],alertbox)}this.node.find('[data-action="destiny-category"]').on("change",this.changeCategory.bind(this))}return originRestoreStep4.prototype.changeCategory=function(e){var newCategoryId=e.currentTarget.value,courseId=e.currentTarget.dataset.courseid.toString(),course=this.data.courses.get(courseId);course.categorydestiny=newCategoryId,this.data.courses.set(courseId,course),sessionStorage.setItem("local_coursetransfer_restore_page",JSON.stringify(this.data,JSONutil.replacer))},originRestoreStep4.prototype.clickNext=function(e){this.node.find(ACTIONS_RESTORE).prop("disabled",!0);var configuration=[];this.data.configuration.forEach((function(config){"origin_schedule_datetime"===config.name?configuration[config.name]=config.value:configuration[config.name]=config.selected})),console.log("type of configuration: ",_typeof(configuration));var alertbox=this.node.find(".alert"),config={destiny_merge_activities:!1,destiny_remove_activities:!1,destiny_remove_groups:!1,destiny_remove_enrols:!1,origin_enrol_users:!1,origin_remove_course:!1,origin_schedule_datetime:0};configuration.destiny_merge_activities&&(config.destiny_merge_activities=configuration.destiny_merge_activities),configuration.destiny_remove_activities&&(config.destiny_remove_activities=configuration.destiny_remove_activities),configuration.destiny_remove_groups&&(config.destiny_remove_groups=configuration.destiny_remove_groups),configuration.destiny_remove_enrols&&(config.destiny_remove_enrols=configuration.destiny_remove_enrols),configuration.origin_enrol_users&&(config.origin_enrol_users=configuration.origin_enrol_users),configuration.origin_remove_course&&(config.origin_remove_course=configuration.origin_remove_course),configuration.origin_schedule&&(config.origin_schedule_datetime=new Date(configuration.origin_schedule_datetime).getTime());var request={methodname:SERVICES_ORIGIN_RESTORE_STEP4,args:{siteurl:this.site,courses:Array.from(this.data.courses.values()),configuration:config}},that=this;Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){that.renderErrors([{code:"100071",msg:"error_not_controlled"}],alertbox)}else that.renderErrors(response.errors,alertbox)})).fail((function(fail){var errors=[];fail.error?errors.push({code:"100072",msg:fail.error}):fail.message?errors.push({code:"100073",msg:fail.message}):errors=[{code:"100074",msg:"error_not_controlled"}],that.renderErrors(errors,alertbox)}))},originRestoreStep4.prototype.renderErrors=function(errors,alertbox){var errorString="";alertbox.removeClass("hidden"),errors.forEach((function(error){errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},originRestoreStep4.prototype.node=null,{initRestoreStep4:function(region,site){return new originRestoreStep4(region,site)}}}));

//# sourceMappingURL=origin_restore_step4.min.js.map