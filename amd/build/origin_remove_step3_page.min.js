/**
 *
 * @module     local_coursetransfer/origin_remove_step3_page
 * @copyright  2023 Proyecto UNIMOODLE
 * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>
 * @author     3IPUNT <contacte@tresipunt.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_coursetransfer/origin_remove_step3_page",["jquery","core/ajax","local_coursetransfer/JSONutil"],(function($,Ajax,JSONutil){let SERVICES_ORIGIN_REMOVE_STEP3="local_coursetransfer_origin_remove_step3",ACTIONS_RESTORE='[data-action="execute-restore"]';function originRemoveStep3(region,site){if(this.node=$(region),this.site=site,this.data=JSON.parse(sessionStorage.getItem("local_coursetransfer_remove_page"),JSONutil.reviver),console.log("Step3 initial data:",this.data),null!==this.data)this.data.courses.forEach((function(course){let courseid=parseInt(course.id),row='tr[data-action="course"][data-courseid="'+courseid+'"]';$(row).removeClass("hidden"),console.log("Courseid and row:",courseid,row)})),this.node.find(ACTIONS_RESTORE).on("click",this.clickNext.bind(this));else{let alertbox=this.node.find(".alert"),errors=[{code:"100088",msg:"error_session_cache"}];this.renderErrors(errors,alertbox),this.node.find(ACTIONS_RESTORE).prop("disabled",!0)}this.node.find("#origin_schedule").on("click",this.clickSchedule.bind(this))}return originRemoveStep3.prototype.clickNext=function(e){this.node.find(ACTIONS_RESTORE).prop("disabled",!0);let alertbox=this.node.find(".alert"),nextruntime=$("#origin_schedule_datetime").val();nextruntime=$("#origin_schedule").prop("checked")?""===nextruntime?0:new Date(nextruntime).getTime():0;const request={methodname:SERVICES_ORIGIN_REMOVE_STEP3,args:{siteurl:parseInt(this.site),courses:Array.from(this.data.courses.values()),nextruntime:nextruntime}};let that=this;Ajax.call([request])[0].done((function(response){if(response.success)window.location.href=response.data.nexturl;else if(response.success){let errors=[{code:"100091",msg:"error_not_controlled"}];that.renderErrors(errors,alertbox)}else that.renderErrors(response.errors,alertbox)})).fail((function(fail){let errors=[];fail.error?errors.push({code:"100092",msg:fail.error}):fail.message?errors.push({code:"100093",msg:fail.message}):errors=[{code:"100094",msg:"error_not_controlled"}],that.renderErrors(errors,alertbox)}))},originRemoveStep3.prototype.renderErrors=function(errors,alertbox){let errorString="";alertbox.removeClass("hidden"),errors.forEach((error=>{errorString+="Error ("+error.code+"): "+error.msg+"<br>"})),alertbox.append(errorString)},originRemoveStep3.prototype.clickSchedule=function(e){this.node.find("#origin_schedule").is(":checked")?this.node.find("#origin_schedule_datetime").attr("disabled",!1):this.node.find("#origin_schedule_datetime").attr("disabled",!0)},originRemoveStep3.prototype.node=null,{initOriginRemoveStep3:function(region,site){return new originRemoveStep3(region,site)}}}));

//# sourceMappingURL=origin_remove_step3_page.min.js.map